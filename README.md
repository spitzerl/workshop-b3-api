# üöÄ API Resource Management

<div align="center">

[![Docker](https://img.shields.io/badge/Docker-Supported-blue?logo=docker)](https://www.docker.com/)
[![Node.js](https://img.shields.io/badge/Node.js-18+-green?logo=node.js)](https://nodejs.org/)
[![MySQL](https://img.shields.io/badge/MySQL-8.0-orange?logo=mysql)](https://www.mysql.com/)
[![Cross-Platform](https://img.shields.io/badge/Cross--Platform-Linux%20%7C%20macOS%20%7C%20Windows-lightgrey)](https://github.com/yourusername/workshop-b3-api)

*API REST robuste pour la gestion des ressources avec d√©ploiement Docker multi-plateforme*

</div>

## üìã Table des mati√®res

1. [üéØ Vue d'ensemble](#-vue-densemble)
2. [‚ö° D√©ploiement rapide](#-d√©ploiement-rapide)
3. [üì¶ Installation d√©taill√©e](#-installation-d√©taill√©e)
4. [‚öôÔ∏è Configuration](#-configuration)
5. [üìö Documentation API](#-documentation-api)
6. [üèóÔ∏è Architecture](#-architecture)
7. [üîß D√©veloppement](#-d√©veloppement)
8. [üÜò D√©pannage](#-d√©pannage)
9. [ü§ù Contribution](#-contribution)

## üéØ Vue d'ensemble

API REST moderne pour la gestion des ressources, d√©velopp√©e avec **Node.js**, **Express** et **MySQL**.
D√©ployment simplifi√© avec **Docker** et support natif **Linux**, **macOS** et **Windows**.

### ‚ú® Fonctionnalit√©s

- üîê **Authentification JWT** s√©curis√©e
- üìä **CRUD complet** des ressources
- üîç **Recherche et pagination** avanc√©es
- üóÑÔ∏è **Base de donn√©es MySQL** optimis√©e
- üê≥ **Containerisation Docker** multi-plateforme
- üöÄ **D√©ploiement en un clic** sur toutes les plateformes
- üîí **S√©curit√© renforc√©e** (utilisateurs non-root, healthchecks)
- üì¶ **Multi-stage builds** pour des images optimis√©es

## ‚ö° D√©ploiement rapide

> **TL;DR :** Quelques commandes Docker pour d√©ployer l'API compl√®te !

### üöÄ M√©thode recommand√©e

**1. Clonez le projet**
```bash
git clone https://github.com/spitzerl/workshop-b3-api.git
cd workshop-b3-api
```

**2. Lancez le d√©ploiement**

**Option A : Script automatique (Linux/macOS/Git Bash)**
```bash
chmod +x deploy.sh && ./deploy.sh
```

**Option B : Commandes manuelles (Recommand√© pour Windows PowerShell)**
```powershell
copy .env.example .env
docker compose up --build -d
docker compose ps
```

**3. C'est tout ! üéâ**
- ‚úÖ API disponible : http://localhost:3002
- ‚úÖ Base de donn√©es : localhost:3308

### üì± M√©thodes sp√©cifiques par plateforme

<details>
<summary><strong>üêß Linux / üçé macOS</strong></summary>

```bash
chmod +x deploy.sh
./deploy.sh
```
</details>

<details>
<summary><strong>ü™ü Windows (Command Prompt)</strong></summary>

```cmd
deploy.bat
```
</details>

<details>
<summary><strong>üê≥ Docker Compose (Manuel) - Recommand√© pour Windows PowerShell</strong></summary>

```powershell
# 1. V√©rifier Docker
docker --version
docker info

# 2. Cr√©er le fichier .env (si absent)
copy .env.example .env

# 3. Arr√™ter les conteneurs existants
docker compose down --remove-orphans

# 4. R√©cup√©rer l'image MySQL
docker compose pull db

# 5. Construire et d√©marrer les services
docker compose up --build -d

# 6. Suivre les logs en temps r√©el
docker compose logs -f

# 7. V√©rifier l'√©tat des services
docker compose ps

# 8. Tester l'API (optionnel)
curl http://localhost:3002
```

**Services accessibles :**
- API : http://localhost:3002
- MySQL : localhost:3308

**Commandes utiles :**
```powershell
docker compose logs api     # Logs API seulement
docker compose logs db      # Logs DB seulement
docker compose restart     # Red√©marrer
docker compose down        # Arr√™ter
docker compose down -v     # Arr√™ter + supprimer volumes
```
</details>

## üì¶ Installation d√©taill√©e

### Pr√©requis

| Composant | Version | Obligatoire | Note |
|-----------|---------|-------------|------|
| **Docker Desktop** | Derni√®re version | ‚úÖ Oui | [T√©l√©charger ici](https://www.docker.com/products/docker-desktop) |
| **Git** | Derni√®re version | üìã Optionnel | Pour cloner le repository |
| **Node.js** | 18+ | ‚ùå Non* | *Uniquement pour d√©veloppement local |

### Installation avec Docker (Recommand√©)

> Cette m√©thode fonctionne sur **Linux**, **macOS**, et **Windows** sans configuration suppl√©mentaire.

#### √âtape 1 : R√©cup√©ration du projet

```bash
# Via Git (recommand√©)
git clone https://github.com/votre-username/workshop-b3-api.git
cd workshop-b3-api

# Ou t√©l√©chargez le ZIP depuis GitHub
```

#### √âtape 2 : Configuration automatique

Le script de d√©ploiement cr√©e automatiquement le fichier `.env` avec les valeurs par d√©faut.
Pour personnaliser la configuration, √©ditez `.env` avant le d√©ploiement :

```bash
# Optionnel : personnaliser la configuration
cp .env.example .env
nano .env  # Linux/Mac
notepad .env  # Windows
```

#### √âtape 3 : D√©ploiement

**Option A : Script universel**
```bash
chmod +x deploy.cmd
./deploy.cmd
```

**Option B : Script sp√©cifique**
```bash
# Linux/macOS/Git Bash
chmod +x deploy.sh && ./deploy.sh

# Windows Command Prompt
deploy.bat
```

#### √âtape 4 : V√©rification

Une fois le d√©ploiement termin√© :
- üåê **API** : http://localhost:3002
- üóÑÔ∏è **MySQL** : localhost:3308 (utilisateur: `api_user`, mot de passe: `apipassword`)

### Installation manuelle (D√©veloppement)

<details>
<summary><strong>Pour les d√©veloppeurs souhaitant installer sans Docker</strong></summary>

#### Pr√©requis
- **Node.js** 18+
- **MySQL** 8.0+
- **npm** ou **yarn**

#### √âtapes

1. **Cloner et installer**
   ```bash
   git clone https://github.com/votre-username/workshop-b3-api.git
   cd workshop-b3-api
   npm install
   ```

2. **Configurer MySQL**
   ```sql
   CREATE DATABASE resource_management;
   CREATE USER 'api_user'@'localhost' IDENTIFIED BY 'apipassword';
   GRANT ALL PRIVILEGES ON resource_management.* TO 'api_user'@'localhost';
   FLUSH PRIVILEGES;
   ```

3. **Configurer l'environnement**
   ```bash
   cp .env.example .env
   # √âditer .env et d√©commenter les variables DB_* pour utilisation locale
   ```

4. **D√©marrer l'API**
   ```bash
   # Mode d√©veloppement (avec rechargement automatique)
   npm run dev

   # Mode production
   npm start
   ```

</details>

## ‚öôÔ∏è Configuration

La configuration se fait via le fichier `.env` cr√©√© automatiquement lors du d√©ploiement.

### Variables principales

| Variable | Description | D√©faut | Obligatoire |
|----------|-------------|---------|-------------|
| `API_PORT` | Port externe pour l'API | `3002` | ‚úÖ |
| `DB_PORT` | Port externe pour MySQL | `3308` | ‚úÖ |
| `MYSQL_ROOT_PASSWORD` | Mot de passe root MySQL | `rootpassword` | ‚úÖ |
| `MYSQL_DATABASE` | Nom de la base | `resource_management` | ‚úÖ |
| `MYSQL_USER` | Utilisateur MySQL | `api_user` | ‚úÖ |
| `MYSQL_PASSWORD` | Mot de passe utilisateur | `apipassword` | ‚úÖ |
| `JWT_SECRET` | Cl√© de chiffrement JWT | *√Ä changer en production* | üîí |
| `NODE_ENV` | Environnement | `development` | üìã |
| `RUN_SEED` | Donn√©es de test | `false` | üìã |

### G√©n√©ration d'une cl√© JWT s√©curis√©e

```bash
# G√©n√©rer une cl√© al√©atoire forte
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"

# Ou utiliser OpenSSL
openssl rand -hex 32
```

### Configuration pour d√©veloppement local

Pour utiliser une base MySQL locale (sans Docker), d√©commentez dans `.env` :

```env
# Configuration locale (d√©commenter pour usage sans Docker)
DB_HOST=localhost
DB_USER=root
DB_PASSWORD=YOUR_MYSQL_PASSWORD
DB_NAME=resource_management
PORT=3001
```

### Personnalisation des ports

Si les ports par d√©faut sont occup√©s :

```env
# Exemple : changer les ports
API_PORT=3005
DB_PORT=3309
```

L'API sera alors accessible sur http://localhost:3005

## üìö Documentation API

### üåê URL de base
```
http://localhost:3002/api
```

### üîê Authentification

L'API utilise **JWT (JSON Web Tokens)** pour l'authentification s√©curis√©e.

**Header requis pour les routes prot√©g√©es :**
```http
Authorization: Bearer <votre_token_jwt>
```

### üéØ Test rapide

```bash
# Tester la connectivit√©
curl http://localhost:3002/api

# Ou utiliser le script de test fourni
./test-api.sh
```

### üîë Routes d'authentification

#### `POST /api/auth/register`
> Cr√©er un nouveau compte utilisateur

**Payload :**
```json
{
  "email": "user@example.com",
  "password": "motdepasse123",
  "firstname": "John",
  "lastname": "Doe"
}
```

**R√©ponse `201` :**
```json
{
  "message": "Utilisateur cr√©√© avec succ√®s",
  "user": {
    "id": 1,
    "email": "user@example.com",
    "firstname": "John",
    "lastname": "Doe"
  }
}
```

#### `POST /api/auth/login`
> Se connecter et obtenir un token JWT

**Payload :**
```json
{
  "email": "user@example.com",
  "password": "motdepasse123"
}
```

**R√©ponse `200` :**
```json
{
  "message": "Connexion r√©ussie",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": 1,
    "email": "user@example.com",
    "firstname": "John",
    "lastname": "Doe"
  }
}
```

### üì¶ Routes des ressources

> Toutes les routes suivantes n√©cessitent l'authentification JWT

#### `GET /api/resources` üîí
> R√©cup√©rer toutes les ressources avec pagination et recherche

**Param√®tres de requ√™te :**
- `page` (optionnel) : Num√©ro de page (d√©faut: 1)
- `limit` (optionnel) : Nombre d'√©l√©ments par page (d√©faut: 10)
- `search` (optionnel) : Recherche par nom

**Exemple :**
```http
GET /api/resources?page=1&limit=5&search=ordinateur
Authorization: Bearer your-jwt-token
```

**R√©ponse `200` :**
```json
{
  "resources": [
    {
      "id": 1,
      "name": "Ordinateur portable",
      "description": "MacBook Pro 13 pouces",
      "category": "Informatique",
      "available": true,
      "created_at": "2024-01-15T10:30:00Z"
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 5,
    "total": 25,
    "totalPages": 5
  }
}
```

#### `GET /api/resources/:id` üîí
> R√©cup√©rer une ressource sp√©cifique

**R√©ponse `200` :**
```json
{
  "id": 1,
  "name": "Ordinateur portable",
  "description": "MacBook Pro 13 pouces",
  "category": "Informatique",
  "available": true,
  "created_at": "2024-01-15T10:30:00Z"
}
```

#### `POST /api/resources` üîí
> Cr√©er une nouvelle ressource

**Payload :**
```json
{
  "name": "Projecteur",
  "description": "Projecteur HD 1080p",
  "category": "Audiovisuel",
  "available": true
}
```

#### `PUT /api/resources/:id` üîí
> Modifier une ressource existante

**Payload (champs optionnels) :**
```json
{
  "name": "Projecteur 4K",
  "description": "Projecteur Ultra HD 4K",
  "available": false
}
```

#### `DELETE /api/resources/:id` üîí
> Supprimer une ressource

**R√©ponse `200` :**
```json
{
  "message": "Ressource supprim√©e avec succ√®s"
}
```

### üö® Codes d'erreur

| Code | Description | Action recommand√©e |
|------|-------------|-------------------|
| `400` | Bad Request | V√©rifiez le format des donn√©es |
| `401` | Unauthorized | Token manquant/invalide/expir√© |
| `403` | Forbidden | Permissions insuffisantes |
| `404` | Not Found | Ressource inexistante |
| `409` | Conflict | Email d√©j√† utilis√© |
| `500` | Internal Server Error | Voir les logs serveur |

**Format d'erreur standardis√© :**
```json
{
  "error": "Message d'erreur",
  "code": "ERROR_CODE",
  "details": "D√©tails techniques (optionnel)"
}
```

## üèóÔ∏è Architecture

### üìÅ Structure du projet
```
workshop-b3-api/
‚îú‚îÄ‚îÄ üöÄ Scripts de d√©ploiement
‚îÇ   ‚îú‚îÄ‚îÄ deploy.sh         # Linux/macOS
‚îÇ   ‚îú‚îÄ‚îÄ deploy.bat        # Windows
‚îÇ   ‚îî‚îÄ‚îÄ deploy.cmd        # Universel
‚îú‚îÄ‚îÄ üê≥ Configuration Docker
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile        # Multi-stage optimis√©
‚îÇ   ‚îú‚îÄ‚îÄ docker-compose.yml # Services orchestr√©s
‚îÇ   ‚îî‚îÄ‚îÄ docker-entrypoint.sh # Point d'entr√©e intelligent
‚îú‚îÄ‚îÄ ‚öôÔ∏è Configuration
‚îÇ   ‚îú‚îÄ‚îÄ .env.example      # Template de configuration
‚îÇ   ‚îú‚îÄ‚îÄ package.json      # D√©pendances Node.js
‚îÇ   ‚îî‚îÄ‚îÄ tsconfig.json     # Configuration TypeScript
‚îú‚îÄ‚îÄ üìù Code source
‚îÇ   ‚îú‚îÄ‚îÄ app.ts           # Application principale
‚îÇ   ‚îú‚îÄ‚îÄ db.ts            # Connexion base de donn√©es
‚îÇ   ‚îú‚îÄ‚îÄ routes/          # D√©finition des routes API
‚îÇ   ‚îî‚îÄ‚îÄ scripts/         # Scripts utilitaires
‚îú‚îÄ‚îÄ üóÉÔ∏è Base de donn√©es
‚îÇ   ‚îî‚îÄ‚îÄ sql/             # Scripts d'initialisation
‚îî‚îÄ‚îÄ üìã Documentation
    ‚îú‚îÄ‚îÄ README.md        # Documentation principale
    ‚îî‚îÄ‚îÄ TESTING.md       # Tests et validation
```

### üõ†Ô∏è Technologies

| Composant | Technologie | Version | R√¥le |
|-----------|-------------|---------|------|
| **Backend** | Node.js + Express | 18+ | API REST |
| **Base de donn√©es** | MySQL | 8.0 | Stockage persistant |
| **Authentification** | JWT | - | S√©curisation des routes |
| **Containerisation** | Docker + Compose | - | D√©ploiement isol√© |
| **Language** | TypeScript | 5+ | D√©veloppement typ√© |
| **Process Manager** | dumb-init | - | Gestion des signaux |

### üóÑÔ∏è Sch√©ma de base de donn√©es

```sql
-- Table des utilisateurs
CREATE TABLE users (
  id INT AUTO_INCREMENT PRIMARY KEY,
  email VARCHAR(255) UNIQUE NOT NULL,
  password VARCHAR(255) NOT NULL,  -- Hash bcrypt
  firstname VARCHAR(100) NOT NULL,
  lastname VARCHAR(100) NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Table des ressources
CREATE TABLE resources (
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  description TEXT,
  category VARCHAR(100) NOT NULL,
  available BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

## üîß D√©veloppement

### Commandes Docker

```bash
# üöÄ Gestion des services
docker compose up -d          # D√©marrer en arri√®re-plan
docker compose up --build -d  # Rebuild + d√©marrer
docker compose down           # Arr√™ter
docker compose down -v        # Arr√™ter + supprimer volumes
docker compose restart        # Red√©marrer

# üìã Monitoring
docker compose ps             # √âtat des conteneurs
docker compose logs -f        # Logs en temps r√©el
docker compose logs -f api    # Logs API uniquement
docker compose logs -f db     # Logs MySQL uniquement

# üßπ Nettoyage
docker compose down --rmi all # Supprimer images
docker system prune -a        # Nettoyage complet Docker
```

### Commandes d√©veloppement

```bash
# üîÑ Mode d√©veloppement (rechargement auto)
npm run dev

# üèóÔ∏è Production
npm start

# üå± Donn√©es de test
npm run seed
```

### Variables d'environnement de d√©veloppement

```env
# Mode debug avec logs d√©taill√©s
NODE_ENV=development
LOG_LEVEL=debug

# Rechargement des donn√©es de test
RUN_SEED=true

# JWT avec expiration longue pour dev
JWT_SECRET=dev-secret-key
JWT_EXPIRES_IN=7d
```

## üÜò D√©pannage

### üîß Probl√®mes courants

<details>
<summary><strong>üö´ Port d√©j√† utilis√©</strong></summary>

**Sympt√¥me :** `Error: listen EADDRINUSE :::3002`

**Solution :**
```bash
# Modifier les ports dans .env
API_PORT=3005
DB_PORT=3309

# Ou trouver et tuer le processus
lsof -ti:3002 | xargs kill -9  # Linux/Mac
netstat -ano | findstr :3002   # Windows
```
</details>

<details>
<summary><strong>üóÑÔ∏è Erreur de connexion base de donn√©es</strong></summary>

**Sympt√¥mes :**
- `ECONNREFUSED`
- `Access denied for user`
- `Unknown database`

**Solutions :**
```bash
# 1. V√©rifier que Docker fonctionne
docker ps

# 2. Attendre le d√©marrage complet (jusqu'√† 2 minutes)
docker compose logs -f db

# 3. Reset complet si n√©cessaire
docker compose down -v
docker compose up --build -d
```
</details>

<details>
<summary><strong>üîë Token JWT invalide</strong></summary>

**Sympt√¥me :** `401 Unauthorized`

**Solutions :**
- V√©rifiez que `JWT_SECRET` est d√©fini dans `.env`
- Le token expire par d√©faut apr√®s 24h
- Reg√©n√©rez un token via `/api/auth/login`
</details>

<details>
<summary><strong>üê≥ Docker issues</strong></summary>

**Cas courants :**
```bash
# Docker daemon not running
sudo systemctl start docker    # Linux
# Ouvrir Docker Desktop         # Windows/Mac

# Permissions insuffisantes (Linux)
sudo usermod -aG docker $USER
newgrp docker

# Espace disque insuffisant
docker system prune -a --volumes
```
</details>

<details>
<summary><strong>ü™ü Erreur Windows : "No such file or directory" docker-entrypoint.sh</strong></summary>

**Sympt√¥me :** `[dumb-init] ./docker-entrypoint.sh: No such file or directory`

**Cause :** Windows peut convertir les fins de ligne Unix (LF) en fins de ligne Windows (CRLF), rendant le script illisible pour Docker.

**Solutions :**

**Option 1 : Utiliser Git Bash ou WSL (Recommand√©)**
```bash
# Dans Git Bash ou WSL
git config core.autocrlf false
git rm --cached -r .
git reset --hard
docker compose up --build -d
```

**Option 2 : Reconfigurer Git globalement**
```cmd
git config --global core.autocrlf input
git clone https://github.com/votre-username/workshop-b3-api.git
cd workshop-b3-api
docker compose up --build -d
```

**Option 3 : Utiliser PowerShell avec commands Docker directes**
```powershell
# Cr√©er le fichier .env manuellement
copy .env.example .env

# Utiliser uniquement docker-compose sans scripts
docker compose up --build -d
```

**V√©rification :** Le fichier `.gitattributes` dans le projet force automatiquement les bonnes fins de ligne pour les nouveaux clones.
</details>

### üìä Monitoring et logs

```bash
# Sant√© des services
curl http://localhost:3002/health

# M√©triques Docker
docker stats

# Inspection d√©taill√©e
docker compose config  # Valider la configuration
docker inspect workshop_b3_api
```

### üîÑ Reset complet

```bash
# Script de reset complet
#!/bin/bash
echo "üßπ Nettoyage complet..."
docker compose down -v --remove-orphans
docker system prune -f
rm -f .env
cp .env.example .env
echo "üöÄ Red√©marrage..."
./deploy.sh
```

## ü§ù Contribution

### D√©veloppement local

1. Fork du projet
2. Cr√©er une branche : `git checkout -b feature/ma-fonctionnalite`
3. D√©velopper avec `npm run dev`
4. Tester : `./test-api.sh`
5. Commit : `git commit -m "feat: ajout fonctionnalit√© X"`
6. Push : `git push origin feature/ma-fonctionnalite`
7. Cr√©er une Pull Request

### Standards

- üéØ **Code** : TypeScript strict, ESLint
- üìù **Commits** : [Conventional Commits](https://conventionalcommits.org/)
- üß™ **Tests** : Couverture > 80%
- üìö **Docs** : README √† jour avec les changements

---

<div align="center">

**üöÄ API Resource Management**

[![Made with ‚ù§Ô∏è](https://img.shields.io/badge/Made%20with-‚ù§Ô∏è-red.svg)](#)
[![Docker](https://img.shields.io/badge/Docker-Ready-blue?logo=docker)](#)
[![Cross Platform](https://img.shields.io/badge/Cross--Platform-‚úì-green)](#)

*D√©ploiement Docker simplifi√© pour toutes les plateformes*

</div>


